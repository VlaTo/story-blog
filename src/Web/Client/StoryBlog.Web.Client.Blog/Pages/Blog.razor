@page "/blog/{slug}"

@using StoryBlog.Web.Client.Blog.Store
@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@switch (Store.Value.StoreState)
{
    case StoreState.Empty:
    {
        break;
    }

    case StoreState.Loading:
    {
        <MudText>Loading...</MudText>

        break;
    }

    case StoreState.Success:
    {
        var post = Store.Value.Post!;
        var comments = Store.Value.Comments;

        <PageTitle>@post.Title</PageTitle>

        <article>
            <div>
                <MudText Typo=@Typo.h4>@post.Title</MudText>
            </div>
            <div>
                <span>@post.CreatedAt</span>
            </div>
            <div>
                <MudMarkdown Value=@post.Text />
            </div>
            
            @if (null == comments || 0 == comments.Count)
            {
                <div>No comments yet</div>
            }
            else
            {
                <MudPaper Square=true Elevation=0 Class="storyblog-blog pa-2">
                    <div>
                        <MudText Typo=@Typo.h6>Comments:</MudText>
                    </div>
                    <div>
                        <CascadingValue Name="EditorCoordinator" Value=@EditorCoordinator>
                            @foreach (var comment in comments)
                            {
                                <Comment Key=@comment.Key CreatedDateTime=@comment.CreatedAt Comments=@comment.Comments Class="pa-2">
                                    <ChildContent>
                                        @comment.Text
                                    </ChildContent>
                                </Comment>
                            }
                        </CascadingValue>
                    </div>
                </MudPaper>
            }
        </article>

        break;
    }

    case StoreState.Failed:
    {
        <MudAlert Severity=@Severity.Error>Cannot load post/comments</MudAlert>

        break;
    }
}

