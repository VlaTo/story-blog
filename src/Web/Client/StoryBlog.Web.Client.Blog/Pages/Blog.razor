@page "/blog/{slug}"

@using StoryBlog.Web.Client.Blog.Store
@using StoryBlog.Web.Client.Blog.Core
@using StoryBlog.Web.Client.Blog.Models
@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@switch (PostStore.Value.StoreState)
{
    case StoreState.Empty:
    {
        break;
    }

    case StoreState.Loading:
    {
        <MudText>Loading...</MudText>

        break;
    }

    case StoreState.Success:
    {
        var post = PostStore.Value.Post!;

        <PageTitle>@post.Title</PageTitle>

        <article>
            <div>
                <MudText Typo=@Typo.h4>@post.Title</MudText>
            </div>
            <div>
                <span>@post.CreatedAt</span>
            </div>
            <div>
                <MudMarkdown Value=@post.Text />
            </div>

            @{
                var store = CommentsStore.Value;

                switch (store.Comments.State)
                {
                    case CommentsCollectionState.Loading:
                    {
                        <div>Loading...</div>

                        break;
                    }

                    case CommentsCollectionState.Success:
                    {
                        <MudPaper Square=true Elevation=0 Class="storyblog-blog pa-2">
                            @if (0 == store.Comments.Count)
                            {

                            }
                            else
                            {
                                <div>
                                    <MudText Typo=@Typo.h6>@Localizer["CommentsHeaderLabel"]</MudText>
                                </div>
                                <Comments OnFetchComments=@DoFetchComments OnPublishReply=@DoPublishReply>
                                    @for (var index = 0; index < store.Comments.Count; index++)
                                    {
                                        if (store.Comments[index] is CommentModel comment)
                                        {
                                            <Comment Key=@comment.Key Comments=@comment.Comments CreatedDateTime=@comment.CreateAt Class="pa-2">
                                                <ChildContent>
                                                    @comment.Text
                                                </ChildContent>
                                            </Comment>
                                        }
                                        else if (store.Comments[index] is CommentReplyModel reply)
                                        {
                                            ;
                                        }
                                    }
                                </Comments>
                            }
                        </MudPaper>

                        break;
                    }

                    case CommentsCollectionState.Failed:
                    {
                        <div>No comments yet</div>
        
                        break;
                    }
                }
            }
        </article>

        break;
    }

    case StoreState.Failed:
    {
        <MudAlert Severity=@Severity.Error>Cannot load post/comments</MudAlert>

        break;
    }
}

